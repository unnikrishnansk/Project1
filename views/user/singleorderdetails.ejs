<%- include('userNavbar')%>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

  <section class="vh-100 gradient-custom-2" >
    <div class="container py-5 h-100" >
      <div class="row d-flex justify-content-center align-items-center h-100"  >
        <div class="col-md-10 col-lg-8 col-xl-6" style="width: 100%;">
          <div class="card card-stepper" style="border-radius: 16px;" >
            <div class="card-header p-4" >
                <div style="height: 150px;">
                  
                    <h5>Delivery address</h5>

                    <div style="display: flex;">
                    <div>
                    <label class="container"><%= ordadd.firstname %>, <%= ordadd.lastname %>,  <%= ordadd.housename %>, <%= ordadd.city %>,  <%= ordadd.state %>, <br> <%= ordadd.postalcode %>, <br> <%= ordadd.mobile %>, <%= ordadd.country %>
                    </label>
                  </div>

                  <% orders.map((order)=>{ %>
                    
                  <% if (order.orderStatus == "pending"){%> 
                    
                    <div style=" width: 60%;margin-left: 10%">
                      <h6>Track status</h6>
                      <div class="d-flex justify-content-between fw-bold" style="margin-left: 15px;">
                        <div>Pending</div>
                        <div>Confirmed</div>
                        <div>In-transit</div>
                        <div>Out for Delivery</div>
                        <div>Delivered</div>
                      </div>
                      
                      <div style="border: 1px solid green; width: 450px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar bg-success" style="width: 0"></div>
                      </div>
                      <p class="fw-bold mt-3 text-primary">Your item is pending to be confirmed</p>
                    </div>
                  <%}else if(order.orderStatus == "confirmed"){%>
                  <div style=" width: 60%;margin-left: 10%; ">
                    <div class="d-flex justify-content-between fw-bold" style="margin-left: 15px;">
                      <div>Pending</div>
                      <div>Confirmed</div>
                      <div>In-transit</div>
                      <div>Out for Delivery</div>
                      <div>Delivered</div>
                    </div>
                    
                    <div style="border: 1px solid green; width: 450px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                      <div class="progress-bar bg-success" style="width: 25%"></div>
                    </div>
                    <p class="fw-bold mt-3 text-success">Your item has been confirmed</p>
                  </div>
                  <%}else if(order.orderStatus == "intransit"){%>
                    <div style=" width: 60%;margin-left: 10%; ">
                      <div class="d-flex justify-content-between fw-bold" style="margin-left: 15px;">
                        <div>Pending</div>
                        <div>Confirmed</div>
                        <div>In-transit</div>
                        <div>Out for Delivery</div>
                        <div>Delivered</div>
                      </div>
                      
                      <div style="border: 1px solid green; width: 450px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar bg-success" style="width: 50%"></div>
                      </div>
                      <p class="fw-bold mt-3 text-success">Your item is in-transit</p>
                    </div>
                  <%}else if(order.orderStatus == "outfordelivery"){%>
                    <div style=" width: 60%;margin-left: 10%;">
                      <div class="d-flex justify-content-between fw-bold" style="margin-left: 15px;">
                        <div>Pending</div>
                        <div>Confirmed</div>
                        <div>In-transit</div>
                        <div>Out for Delivery</div>
                        <div>Delivered</div>
                      </div>
                      
                      <div style="border: 1px solid green; width: 450px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar bg-success" style="width: 75%"></div>
                      </div>
                      <p class="fw-bold mt-3 text-success">Your item has been out for delivery</p>
                    </div>
                  <%}else if(order.orderStatus == "delivered"){%>
                    <div style=" width: 60%;margin-left: 10%;">
                      <div class="d-flex justify-content-between fw-bold " style="margin-left: 15px;">
                        <div>Pending</div>
                        <div>Confirmed</div>
                        <div>In-transit</div>
                        <div>Out for Delivery</div>
                        <div>Delivered</div>
                      </div>
                      
                      <div style="border: 1px solid green; width: 550px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar bg-success" style="width: 100%"></div>
                      </div>
                     <p class="fw-bold mt-3 text-success">Your item has been delivered</p>
                    </div>
                    <%}else if(order.orderStatus == "returned"){%>
                      <div style=" width: 60%;margin-left: 10%;">
                        <div class="d-flex justify-content-between fw-bold " style="margin-left: 15px;">
                          <div>Return</div>
                          <div>Return</div>
                        </div>
                        
                        <div style="border: 1px solid red; width: 550px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                          <div class="progress-bar bg-danger" style="width: 100%"></div>
                        </div>
                       <p class="fw-bold mt-3 text-primary">Your item has been returned</p>
                      </div>
                      <%}else if(order.orderStatus == "cancelled"){%>
                        <div style=" width: 60%;margin-left: 10%;">
                          <div class="d-flex justify-content-between fw-bold " style="margin-left: 15px;">
                            <div>Cancel</div>
                            <div>Cancel</div>
                          </div>
                          
                          <div style="border: 1px solid red; width: 550px;margin-left: 40px;" class="progress ml-5" role="progressbar" aria-label="Success example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                            <div class="progress-bar bg-danger" style="width: 100%"></div>
                          </div>
                         <p class="fw-bold mt-3 text-danger">Your item has been cancelled</p>
                        </div>
                        <%}%>
                </div>

                   
                   
                  

                </div>
                  <!-- <div style="border: 1px solid green;"> -->
                 

                    <div style="box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;border-radius: 16px;display: flex;">
                    <div class=" align-items-center" style="margin-top: 15px;margin-left: 15px;width: 35%;border-radius: 16px;padding: 20px;">
                      <div>
                        <p class="text-muted mb-2 fw-bold"> Order ID : <span class="fw-bold text-body">
                            <%=order.orderid %>
                          </span></p>
                      </div>
                      <div>
                        <p class="text-muted mb-2 fw-bold"> Placed On :  <span class="fw-bold text-body">
                          <%=order.purchaseDate.toISOString().slice(0, 10) %>
                          </span></p>
                      </div>
                      <div>
                        <% if(order.orderStatus == "delivered" || order.orderStatus == "returned" || order.orderStatus == "cancelled"){ %>
                        <p class="text-muted mb-2 fw-bold"> Delivered Date : <span class="fw-bold text-body">
                          <%=order.deliveryDate.toISOString().slice(0, 10) %>
                        </span></p>
                        <%  }else{ %>
                        <p class="text-muted mb-2 fw-bold"> Delivery Expected : <span class="fw-bold text-body">
                              <%=order.deliveryDate.toISOString().slice(0, 10) %>
                        </span></p>
                        <%}%>
                      </div>
                      <div>
                        <p class="text-muted mb-2 fw-bold"> Payment Method : <span class="fw-bold text-body">
                          <%= order.paymentMethod.toUpperCase() %>
                            </span></p>
                      </div>
                          <div>
                        <p class="text-muted mb-0 fw-bold"> Order Status : <span class="fw-bold text-body">
                            <%=order.orderStatus %>
                          </span> </p>
                      </div>
                      <a class="ml-3 mt-2" href="/invoice?id=<%= order.orderid %> "><span>Download Invoice</span></a>

                    </div>
                      <% order.orderItems.forEach((prod)=>{ %>

                        <div class="d-flex flex-row mb-4 pb-2 "
                          style="box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;padding: 15px; border-radius: 10px; width: 35%; margin-top: 15px;margin-left: 25px;">
                          <div class="flex-fill">
                            <h6 class="bold">
                              <%=prod.name %>
                            </h6>
                            <img style="width: 100px; height: 60px;" src="/static/uploads/<%=prod.image%>" alt="">
                            <p class="text-muted fw-bold"> Qty: <%=prod.quantity%>
                            </p>
                            <h6 class="mb-3 fw-bold"> Price : <span>&#8377; <%= prod.price %>
                              </span>
                            </h6>
                           
                          </div>
                         
                          <div>

                            
       <% const deliverydate = order.deliveryDate%>
       <% const returnexpdate = new Date(deliverydate)%>
       <% returnexpdate.setDate(returnexpdate.getDate() + 5 )%>
       <% const currentdate = new Date() %>
       <% console.log(returnexpdate,currentdate)%>


                             <!-- <div class="d-flex" > -->
                              
                           <!-- <div>
                              <a href="" style="text-decoration: none;margin-left: 5px; margin-right: 5px;">View product</a>
                          </div> -->
                           <% if(order.orderStatus == "returned"){ %>
                            <div>
                              <h5 class="fw-normal ml-5 pl-5" style="margin-left: 5px;margin-right: 5px;"><a
                                  style="text-decoration: none;margin-left: 5px;" href="/returnorder?id=<%=prod.productID%>&odr=<%=order.orderid%>"></a>
                              </h5>
                            </div>
                          
                            

                            <% } else if(order.orderStatus == "delivered"){ %>
                              <% if(returnexpdate == currentdate){ %>
                                <div>

                                </div>
                              <% }else{ %>
                              <div>
                                <h5 class="fw-normal ml-5 pl-5" style="margin-left: 5px;margin-right: 5px;"><a
                                    style="text-decoration: none;margin-left: 5px;" href="/returnorder?id=<%=prod.productID%>&odr=<%=order.orderid%>"></a>
                                </h5>
                              </div>
                            <% } %>
                            <%} else{%>
                              <div>
                            <h5 class="fw-normal mr-5 pr-5 "><a style="text-decoration: none;margin-left: 5px;margin-right: 5px;"
                                onclick="return confirm('Are you sure you want to cancel this order?')"
                                href="/cancelorder?id=<%=prod.productID%>&odr=<%=order.orderid%>"></a>
                            </h5>
                          </div>
                        <!-- </div> -->
                          <%}%>
                          </div>
                          
                         
                        </div>
                     
                      
                        <% }) %>
                      </div>

                          <p class="text-muted mb-0 fw-bold " style="margin-left: 20px;margin-top: 5%;"> Total Price : <span class="fw-bold text-body">&#8377; 
                              <%=order.totalAmount %>
                            </span> </p>
                           
                            <% if(order.orderStatus == "delivered"){ %>
                              <p class="text-muted mb-0 fw-bold"> <span class="fw-bold text-body">
                                <!-- <%=order.deliveryDate.toISOString().slice(0, 10) %> -->
                              </span> </p>
                            <%  }else{ %>
                          <p class="text-muted mb-0 fw-bold"><span class="fw-bold text-body">
                              <!-- <%=order.deliveryDate.toISOString().slice(0, 10) %> -->
                            </span> </p>
                            <%}%>
                          <p class="text-muted mb-0 fw-bold">  <span class="fw-bold text-body">
                              <!-- <%= order.paymentMethod %> -->
                            </span> </p>

                         
                          <% }) %>
            </div>

           


           
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
   
  </script>