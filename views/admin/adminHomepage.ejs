<%-include('adminNavbar')%>



  <div class="container text-center mb-3" >

    <div class="row text-center mt-2">
        <div class="col-lg-12 ">
          <div class="card" >
            <div class="card-body ">
              <h4 class="card-title p-2">Dashboard</h4>
              <div class="row  bg-secondary">
                <div class="col-md-3 stretch-card grid-margin">
                  <div class="card bg-gradient-danger">
                    <div class="card-body">
                      <h4 class="mb-3">Total Orders
                      </h4>
  
                      <h2 class="mb-5">
                         <%=data.totalOrders %>
                      </h2>
  
                    </div>
                  </div>
                </div>
                <div class="col-md-3 stretch-card grid-margin">
                  <div class="card bg-gradient-danger ">
                    <div class="card-body">
  
                      <h4 class="mb-3" >Total Sale
                      </h4>
  
                      <h2 class="mb-5">
                         <%=data.totalSaleAmount%>
                      </h2>
                    </div>
                  </div>
                </div>
                <div class="col-md-3 stretch-card grid-margin">
                  <div class="card bg-gradient-info card-img-holder ">
                    <div class="card-body">
                      <h4 class="font-weight-normal mb-3">Total Users
                      </h4>
                      <h2 class="mb-5">
                         <%=data.totalUsers%> 
                      </h2>
  
                    </div>
                  </div>
                </div>
                <div class="col-md-3 stretch-card grid-margin">
                  <div class="card bg-gradient-success card-img-holder ">
                    <div class="card-body">
                      <h4 class="font-weight-normal mb-3">Total Products
                      </h4>
                      <h2 class="mb-5">
                         <%=data.totalProducts %>
                      </h2>
  
                    </div>  
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>



    <form action="/admin/report" method="post">

      <div class="row m-md-1 bg-white pb-2  rounded ">
        
        <div class="col-md-2 grid-margin stretch-card pt-3 d-flex w-50" >
          <div class="w-50 mt-2" >
          <span class="fw-bold">Sales Report : </span>
        </div>
          <select class="form-select form-select-sm w-100 font-weight-bold" style="
           margin-bottom: 5px; margin-top: 5px;" aria-label=".form-select-sm example" name="salesReport" id="sales"
            onchange="getData()">
            <option selected>Sales Category</option>
            <option value="Daily">Daily</option>
            <option value="Monthly">Monthly</option>
            <option value="Yearly">Yearly</option>
          </select>
        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3" style="display: none;" id="chooseMonth">
          <select class=" form-select form-select-sm" style="width: 100%; border-color: blue;
            border-width: 1px; color: rgb(15, 1, 3); border-radius: 20px; font-weight:
            bold; margin-bottom: 5px; margin-top: 5px;" aria-label=".form-select-sm example" name="month">
            <option selected>Monthly</option>
            <option value="2023-01-01">January 2023</option>
            <option value="2023-02-01">February 2023</option>
            <option value="2023-03-01">March 2023</option>
            <option value="2023-04-01">April 2023</option>
            <option value="2023-05-01">May 2023</option>
            <option value="2023-06-01">June 2023</option>
            <option value="2023-07-01">July 2023</option>
            <option value="2023-08-01">August 2023</option>
            <option value="2023-09-01">September 2023</option>
            <option value="2023-10-01">October 2023</option>
            <option value="2023-11-01">November 2023</option>
            <option value="2023-12-01">December 2023</option>
          </select>

        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3" style="display: none;" id="chooseDay">
          <input type="date" name="today">

        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3" style="display: none;" id="chooseYear">
          <select class=" form-select form-select-sm" style="width: 100%; border-color: blue;
            border-width: 1px; color: rgb(15, 1, 3); border-radius: 20px; font-weight:
            bold; margin-bottom: 5px; margin-top: 5px;" aria-label=".form-select-sm example" name="year">
            <option selected>Year</option>
            <option value="2023"> 2023</option>

          </select>

        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3">
          <button class="btn btn-primary" type="submit">Submit</button>
        </div>

      </div>
    </form>
    <!--  #################  Head Portion: total order,product& user #########-->
    
    <!--  #################  end ################# -->


    <!--  #################  Sales Section ################# -->
    <div  style="height: 450px; width: 100%;margin-top: 30px;margin: auto; display: flex;">
    <div style="width: 50%;" >
    <canvas id="myChart" width="150" height="150" class="p-2"></canvas>
    </div>
    <div style="width: 50%;">
    <canvas id="myChart2" width="150" height="150" class="p-2"></canvas>
    </div>
    </div>
      <!--  #################  Nav ################# -->
      
      <!--  ~~~~~~~~~~~~~~~~~~~~~~  Nav end ~~~~~~~~~~~~~~~~~~~~~~ -->


      <!--  #################  Chart Section of Full Orders ################# -->
      <div class="row mt-md-2 pb-md-2 shadow" id="totalSales">
        <div class="col-md-7 grid-margin stretch-card">
          <div class="card">
            <!-- <div class="card-body">
              <div class="clearfix">
                <h4 class="card-title float-left">Sales Statistics</h4>
                <div id="visit-sale-chart-legend" class="rounded-legend legend-horizontal legend-top-right float-right">
                </div>

              </div>

              <canvas id="myChart" class="shadow p-2"></canvas>

            </div>
          </div> -->
        </div>
        <!-- <div class="col-md-5 grid-margin stretch-card">
          <div class="card">
            <div class="card-body bg-secondary rounded">
              <h4 class="card-title pb-3">Order Details</h4>

              <div class="card-body bg-white rounded">

              <h5 class="pb-md-1 ">Total Number of Orders:  <%=data.totalOrders %>
              </h5>
              <h6 class="pb-md-1">Total Number of deliveries:  <%=data.totalDelivery %>
              </h6>
              <h6 class="pb-md-1">Total Number of cancellations: <%= data.totalCancelled %>
              </h6>
              <h6 class="pb-md-5">Total Number of returns:  <%=data.totalReturn %>
              </h6>
            </div>
            </div>
          </div>
        </div> -->
      </div>
      <!--  ~~~~~~~~~~~~~~~~~~~~~~  Nav end ~~~~~~~~~~~~~~~~~~~~~~ -->


      <!--  #################  Monthly Sales ################# -->
      <!-- <div class="row mt-md-2 pb-md-2 text-center shadow" id="totalSales">
      <h4 class="p-2" style="color: palevioletred;">Monthly Sales</h4>
      <div class="row mt-md-2 pb-md-2">
        <div class="col-md-7 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <div class="clearfix">
                <h4 class="card-title float-left">Monthly Sales Statistics</h4>
                <div id="visit-sale-chart-legend" class="rounded-legend legend-horizontal legend-top-right float-right"></div>
               
              </div>
            
                <canvas id="myChartMonthly" class="shadow p-2"></canvas>
            
            </div>
          </div>
        </div>
        <div class="col-md-5 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title pb-3">Orders</h4>
            
              <h5 class="pb-md-1 " id="ord" >Total Number of Orders:  data.totalOrders  </h5>
              <h6 class="pb-md-1" id="deli">Total Number of deliveries:  data.totalDelivery  </h6>
              <h6 class="pb-md-1" id="can">Total Number of cancellations:  data.totalCancelled  </h6>
              <h6 class="pb-md-5" id="ret">Total Number of returns:  data.totalReturn  </h6>
            </div>
          </div>
        </div>
      </div>
     
       
    </div> -->
      <!--  ~~~~~~~~~~~~~~~~~~~~~~  Monthly end ~~~~~~~~~~~~~~~~~~~~~~ -->
      <script>
        function getData() {
      const selectedValue = document.getElementById('sales').value;
      console.log(selectedValue);
      const mode = selectedValue;
      let options;
      if (mode === "Daily") {
        document.getElementById('chooseYear').style.display = "none";
        document.getElementById('chooseMonth').style.display = "none";
        document.getElementById('chooseDay').style.display = "block";
      } else if (mode === "Monthly") {
        document.getElementById('chooseDay').style.display = "none";
        document.getElementById('chooseYear').style.display = "none";
        document.getElementById('chooseMonth').style.display = "block";
      } else if (mode === "Yearly") {
        document.getElementById('chooseMonth').style.display = "none";
        document.getElementById('chooseDay').style.display = "none";
        document.getElementById('chooseYear').style.display = "block";
      } else {

      }
    }



        var delivered = JSON.stringify(<%=data.totalDelivery%>) 
        var returned = JSON.stringify( <%=data.totalReturn%>) 
        var cancelled = JSON.stringify(<%=data.totalCancelled%>) 
        var result = [delivered,returned,cancelled]
        console.log("Data from EJS:", result);
    </script>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
  <script> 
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['delivered','returned','cancelled'],
            datasets: [{
                label: 'Statistics',
                data: result,
                backgroundColor: [
                    'rgba(76, 175, 80, 0.8)','RGBA(255, 152, 0, 0.8)','RGBA(156, 39, 176, 0.8)'
                ],
                borderColor: [
                ' rgba(13, 110, 253,1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
    </script>

<script>
  var category= JSON.stringify(<%=data.totalCategories%>) 
  var products = JSON.stringify( <%=data.totalProducts%>) 
  var users = JSON.stringify(<%=data.totalUsers%>) 
  var result2 = [category,products,users]
  console.log("Data from EJS:", result);
</script>

<script>
     
    
  var ctx = document.getElementById('myChart2').getContext('2d');
  var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
          labels: ['category','products','users'],
          datasets: [{
              label: 'Statistics',
              data: result2,
              backgroundColor: [
                  'rgba(76, 175, 80, 0.8)','RGBA(255, 152, 0, 0.8)','RGBA(156, 39, 176, 0.8)'
              ],
              borderColor: [
              ' rgba(13, 110, 253,1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero: true
                  }
              }]
          }
      }
  });
  </script>
  <!-- <script>

    //Fetch Data *****************************************************************
    function fetchSalesData(url, options, type, id) {

      fetch(url, options)
        .then(response => response.json())
        .then(data => {

          console.log(data);

          createGraph(data, type, id)


        })
    }

    //select sales Order Type*******************************************************
    // function getData() {
    //   const selectedValue = document.getElementById('sales').value;
    //   console.log(selectedValue);
    //   const mode = selectedValue;
    //   let options;
    //   if (mode === "Daily") {
    //     document.getElementById('chooseYear').style.display = "none";
    //     document.getElementById('chooseMonth').style.display = "none";
    //     document.getElementById('chooseDay').style.display = "block";
    //   } else if (mode === "Monthly") {
    //     document.getElementById('chooseDay').style.display = "none";
    //     document.getElementById('chooseYear').style.display = "none";
    //     document.getElementById('chooseMonth').style.display = "block";
    //   } else if (mode === "Yearly") {
    //     document.getElementById('chooseMonth').style.display = "none";
    //     document.getElementById('chooseDay').style.display = "none";
    //     document.getElementById('chooseYear').style.display = "block";
    //   } else {

    //   }
    // }

    // For Creating Graph ****************************************************************
    function createGraph(data, type, id) {

      // Get a reference to the canvas element
      const ctx = document.getElementById(id).getContext('2d');

      // Set up your data for the chart
      const labels = data.map(item => item.label); // Assuming each data object has a 'label' property
      const values = data.map(item => item.value); // Assuming each data object has a 'value' property
      console.log("values", values);
      // Create the chart
      new Chart(ctx, {
        type: type, // Specify the type of chart you want (bar, line, pie, etc.)
        data: {
          labels: labels,
          datasets: [{
            label: 'My Data',
            data: values,
            backgroundColor: 'rgba(0, 123, 255, 0.5)' // Set a color for the bars
          }]
        },
        options: {
          // Configure additional options as needed
        }
      });
    }

    //Document Listener ******************************************************
    document.addEventListener('DOMContentLoaded', function () {
      const mode = 'Full';
      const url = `/admin/api/fetchSales?id=${mode}`;

      const options = {
        method: 'POST',
        Headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: url })
      }
      const type = 'bar';
      const id = "myChart"
      fetchSalesData(url, options, type, id)


    })






  </script> -->
